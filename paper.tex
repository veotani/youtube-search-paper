\documentclass[a4paper]{article}
\usepackage{pmstyle}
\begin{document}
\hyphenation{СПбГУ}
\udk{004.021}
\author{Орлов~А.\:С., Севрюков~С.\:Ю.}
\title{Реализация алгоритма поиска по субтитрам YouTube}

\renewcommand{\thefootnote}{ }
{\footnotetext{{\it Орлов Антон Сергеевич} -- студент, Санкт-Петербургский государственный университет; e-mail: ion6431@gmail.com, тел.: +7(999)229-50-25}}
{\footnotetext{{\it Севрюков Сергей Юрьевич} -- старший преподаватель, Санкт-Петербургский государственный университет; e-mail:  s.sevryukov@spbu.ru, тел.: +7(911)910-94-88}}

\maketitle

\razdel{Введение}
В наши дни платформа хранения, доставки и показа видео YouTube пользуется огромной популярностью. Она обладает большим спектром возможностей, что позволяет упрощать процессы работы с видеоматериалами. Одним из таких процессов является поиск по тексту субтитров YouTube, генерируемых автоматически, что предоставляет возможность реализации алгоритма автоматизации этого процесса. Это позволит повысить производительность организаций, активно использующих YouTube в работе. 

Примером такой организации может быть центр развития электронных образовательных ресурсов Санкт-Петербургского государственного университета, который занимается созданием и выпуском онлайн-курсов. В процессе их создания видеолекции просматриваются авторами для поиска ошибок. В курсах для публикации на платформе Coursera в среднем 4-6 модулей; на платформе Открытое Образование --- 10-12 модулей. Каждый модуль включает в себя около 1,5 часа видеолекций. На один курс приходится минимум 6 часов итогового видеоматериала, не считая чернового. Для упрощения ориентации в таком массиве данных было решено разработать описываемый алгоритм.
%Видеоматериалы представляют из себя лекции, длиной от 3 до 12 минут. Они содержат в себе сплошную речь без шумов на заднем плане.
\razdel{Постановка задачи}
В процессе решения задачи и реализации алгоритма были сформулированы следующие начальные условия:
\NList{
\ITEM Массив видео, опубликованных на YouTube, по которым будет производиться поиск.
\ITEM Данные учётной записи Google.
\ITEM Наличие речи в видео.}

Необходимо подчеркнуть, что качество генерируемых субтитров напрямую зависит от качества звука в видео \cite{autosub}.
Описываемая реализация направлена на повышение эффективности работы с видео в формате, предустановленном ЦРЭОР, однако может быть применена и к любым другим видео, удовлетворяющих начальным условиям.


Цель заключается в реализации алгоритма, на вход которому подаётся несколько видео, в которых присутствует речь, данные учётной записи Google, с которой были загружены видео, и поисковый запрос. Результатом является список ссылок на видео, отсортированных в порядке уменьшения релевантности. 

\razdel{Получение текста видео}
Извлечение текста будет производиться с помощью YouTube Data API. В него входит метод \verb|captions.download|. Согласно документации, метод требует авторизации, следовательно, её необходимо реализовать.


\podrazdel{Авторизация}
YouTube API поддерживает два способа авторизации: OAuth 2.0 и API Key. Второй способ не предусматривает получение прав, поэтому в дальнейшем он рассматриваться не будет. Использование метода запрашивает наличие хотя бы одного из двух разрешений: \verb|youtubepartner| или \verb|youtube.force-ssl|. Они указываются в параметре \verb|scope|. Оставшиеся действия описаны в руководстве API \cite{guideauth}. После прохождения авторизации становится возможным использование метода получения субтитров.

\podrazdel{Получение субтитров}
Метод \verb|captions.download| принимает в качестве обязательного параметра \verb|id| дорожки субтитров. Её можно получить с помощью метода \verb|captions.list|. Google накладывает условие, согласно которому субтитры возможно получить только из видео, загруженных пользователем. Данное условие может быть снято, если пользователь разрешает взаимодействие третьим лицам с его видео. Организации, которым требуется поиск по собственным видео, это условие не создаст препятствий.

\razdel{Индексация}
Рассмотрим процесс создания обратного индекса. Сначала необходимо каждое слово привести к начальной форме. Далее слову сопоставляется список видео, и список временных промежутков, в которых это слово встречается.

Полученный текст имеет следующий формат: в первой строке находится указание временного промежутка, во второй --- текст, который соответствует этому промежутку, и пустая третья строка. Все дальнейшие строки подчиняются этому правилу. Это позволяет создать цикл с шагом 3, внутри которого будет происходить наполнение индекса. Первая строка обрабатывается с помощью регулярного выражения: \verb=(^|\n)(\d{1,2}):(\d{2}):(\d{2})\.(\d{3})=. С помощью этого можно получить значение секунд, которое соответствует началу временного промежутка видео с нужным словом. Вторая строка делится пробелами на слова, каждое из которых приводится к нормальной форме, записывается как ключ индекса, а к значению добавляется видео и соответствующие секунды. 

\razdel{Реализация метода поиска}
Для того, чтобы найти видео, которое удовлетворяет поисковому запросу, необходимо вычислить меру схожести запроса и всех видео, в которых присутствуют слова из запроса. В качестве такой меры можно выбрать сosine similarity. Подробный разбор алгоритма описан в книге Introduction to Information Retrieval \cite{informretr}. Результатом работы метода является список видео с сопоставленными им cosine similarity. Искомый результат будет получен при сортировке по убыванию.

\razdel{Использование ElasticSearch}
Рассмотрим реализацию поиска с помощью ElasticSearch. Чтобы проиндексировать субтитры, полученные с помощью вышеизложенных методов, необходимо выделить текст без отметок о времени. Они находятся в каждой третьей строке, начиная с первой. Также каждая третья строка является пустой, поэтому их можно игнорировать. Для повышения качества поиска возможно индексировать каждую строку отдельно, чтобы пользователь получал не список видео, а список фрагментов, в которых употребляются слова из его запроса. Это может быть полезно для поиска конкретной темы, которая обсуждалась в видео. ElasticSearch является RESTful сервисом, из-за чего для каждой строки необходимо делать два запроса. Это сильно понижает производительность системы.


\razdel{Метод деления субтитров на фрагменты}
Субтитры состоят из фраз с привязкой к временному промежутку в видео. Временные промежутки могут пересекаться (тогда во время просмотра этого видео с субтитрами пользователь видит сразу несколько строчек субтитров). Однако если существуют моменты видео, в которых нет речи, в этом временном промежутке не генерируются субтитры. Следовательно, когда делаются паузы в речи, субтитры тоже не генерируются. Такие паузы можно вычислить, сравнивая конец временного промежутка с началом следующего. Если второй начинается раньше, чем кончается первый, то есть пересечение, и паузы в речи не было. В противном случае пауза была, и это может значить, что сменилась тема разговора. По таким паузам происходит деление файла субтитров на документы. Каждый из них индексируется, и поиск будет идти уже по фрагментам видео.
\razdel{Тесты}
Ниже приведена информация о затратах времени для индексации с помощью рассмотренных методов. Все видео являются лекциями, поэтому количество моментов, в которых нет речи, минимально.

\Table{Сравнение }{|p{3cm}|p{2cm}|p{2cm}|}{
\centering\textbf{Длительность видео} & \centering\textbf{Inverted Indexing} & \centering\textbf{ElasticSearch} \nextline
7:52 & 656мс.& 17,9с. \nextline
1:58:35& 1358мс. & 3м. 6с. \nextline
2:55:02 & 1287мс. & 5м. 4с. \nextline
35:34 & 919мс. & 2м. 2с. \nextline
53:19 & 989мс. & 3м. 46с. \nextline
}

Таким образом, ElasticSearch имеет гораздо более низкую скорость работы, но описываемый алгоритм имеет приложения в таких ситуациях, когда скорость не влияет на продуктивность системы и компании-заказчику выгоднее работать с готовыми решениями.


Модификация сегментации субтитров позволяет как улучшить, так и ухудшить время индексации. Это зависит от формата видео, по которым настраивается поиск. Например, для ЦРЭОР эта модификация может улучшить качество алгоритма, так как во время съёмок авторы периодически делают паузы, чтобы обозначить конец модуля, темы и т.п.

\razdel{Вывод}
Для повышения эффективности данный результат может быть интегрирован в информационную систему, в которой присутствуют компоненты взаимодействия с материалами, опубликованными на YouTube. Рассмотренные вариации методов поиска показывают, что они могут варьироваться в зависимости от формата видео, для которых необходимо внедрение поиска. Алгоритм авторизации может быть модифицирован таким образом, чтобы пользователю не нужно было проходить авторизацию самостоятельно.\\\\\\

\begin{thebibliography}{40}
\bibitem{informretr} Manning~C.\:D., Raghavan~P., Schutze H. Introduction to Information Retrieval. 2008. 151~p.
\bibitem{autosub} Как создать субтитры автоматически --- Cправка --- YouTube [Электронный ресурс]: \url{URL : https://support.google.com/youtube/answer/6373554?hl=ru} (дата обращения: 14.03.18).
\bibitem{guideauth} Implementing OAuth 2.0 Authorization | YouTube API | Google Developers [Электронный ресурс]: \url{URL : https://developers.google.com/youtube/v3/guides/authentication} (дата обращения 14.03.18)
\end{thebibliography}
\end{document}